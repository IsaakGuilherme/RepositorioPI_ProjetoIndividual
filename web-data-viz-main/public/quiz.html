<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Santista</title>
  <link rel="stylesheet" href="./css/quiz.css">
  <link rel="icon" href="./assets/icon/Santos.ico">
  <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&display=swap" rel="stylesheet">
</head>

<body onload="onloadEsconder()">
  <div class="quiz-header">
    <div class="container">
      <h1 class="titulo">Quiz do Santos</h1>
      <a href="index.html" class="btn-voltar">Voltar ao Início</a>
    </div>
  </div>

  <section class="quiz-main">
    <div class="container">
      <div class="quiz-box">

        <div class="quiz-iniciar" id="quiz-iniciar">
          <h2>Pronto para iniciar o quiz?</h2>
          <button onclick="iniciarQuiz()" id="btnIniciarQuiz">Indicar Quiz</button>
        </div>

        <div id="quiz-geral">
          <div class="quiz-pergunta">
            <h2>Pergunta <span id="spanNumeroDaQuestaoAtual"></span></h2>
            <p id="perguntaDaQuestaoAtual"><span id="spanQuestaoExibida"></span></p>
          </div>
          <div class="quiz-opcoes">
            <button class="opcao" id="opcaoUm" onclick="selecionarResposta('alternativaA')">1900</button>
            <button class="opcao" id="opcaoDois" onclick="selecionarResposta('alternativaB')">1912</button>
            <button class="opcao" id="opcaoTres" onclick="selecionarResposta('alternativaC')">1920</button>
            <button class="opcao" id="opcaoQuatro" onclick="selecionarResposta('alternativaD')">1935</button>

          </div>
          <div class="quiz-progresso">
            <span>Pergunta <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span></span>
          </div>
          <div class="quiz-controle">
            <button id="btnSubmeter" class="btn-submeter">Responder</button>
            <button class="btn-proximo">Próxima</button>
          </div>
        </div>
      </div>
    </div>
  </section>
</body>

</html>

<script>
  let listaDeQuestoes = [
    {
      pergunta: "Qual jogador revelado pelo Santos é o seu preferido?",
      alternativaA: "Pelé",
      alternativaB: "Robinho",
      alternativaC: "Neymar",
      alternativaD: "Rodrygo"
    },
    {
      pergunta: "Qual foi o título mais marcante para você como torcedor do Santos?",
      alternativaA: "Libertadores 2011",
      alternativaB: "Brasileirão 2002",
      alternativaC: "Mundial de 1962",
      alternativaD: "Paulista 2015"
    },
    {
      pergunta: "Qual ídolo representa melhor a história do Santos FC?",
      alternativaA: "Pelé",
      alternativaB: "Pepe",
      alternativaC: "Robinho",
      alternativaD: "Giovanni"
    },
    {
      pergunta: "Qual dessas camisas do Santos você considera a mais bonita?",
      alternativaA: "Tradicional branca",
      alternativaB: "Listrada preta e branca",
      alternativaC: "Camisa azul (terceiro uniforme)",
      alternativaD: "Rosa comemorativa"
    },
    {
      pergunta: "Em qual estádio você mais sonha em assistir um jogo do Santos?",
      alternativaA: "Vila Belmiro",
      alternativaB: "Maracanã",
      alternativaC: "Morumbi",
      alternativaD: "Arena Corinthians"
    },
    {
      pergunta: "Qual geração de jogadores do Santos mais te empolgou?",
      alternativaA: "Anos 60 (Pelé, Pepe...)",
      alternativaB: "Anos 2000 (Robinho, Diego...)",
      alternativaC: "Anos 2010 (Neymar, Ganso...)",
      alternativaD: "Atual (Marcos Leonardo, Deivid...)"
    },
    {
      pergunta: "Qual desses rivais você mais gosta de vencer?",
      alternativaA: "Corinthians",
      alternativaB: "Palmeiras",
      alternativaC: "São Paulo",
      alternativaD: "Flamengo"
    },
    {
      pergunta: "Qual foi o jogo mais emocionante do Santos que você já viu?",
      alternativaA: "Final da Libertadores 2011",
      alternativaB: "Santos 5x4 Flamengo (2011)",
      alternativaC: "Santos 3x1 Corinthians (Paulista 2015)",
      alternativaD: "Outro"
    },
    {
      pergunta: "Qual música ou canto da torcida você mais se identifica?",
      alternativaA: '"Agora quem dá bola é o Santos"',
      alternativaB: '"Santos, Santos, gol!"',
      alternativaC: '"Vamos Santos, vamos ser campeão"',
      alternativaD: 'Outra'
    },
    {
      pergunta: "Qual dessas revelações recentes você acredita que terá mais sucesso na Europa?",
      alternativaA: "Rodrygo",
      alternativaB: "Kaiky",
      alternativaC: "Marcos Leonardo",
      alternativaD: "Ângelo"
    }
  ];


  // variáveis globais    
  let numeroDaQuestaoAtual = 0
  let quantidadeDeQuestoes = listaDeQuestoes.length
  // let isUltima = numeroDaQuestaoAtual == quantidadeDeQuestoes-1 ? true : false

  function onloadEsconder() {
    document.getElementById('quiz-geral').style.display = "none";
  }

  function iniciarQuiz() {
    document.getElementById('quiz-geral').style.display = "block";
    document.getElementById('quiz-iniciar').style.display = "none";
    document.getElementById('btnIniciarQuiz').style.display = "none";

    document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes

    preencherHTMLcomQuestaoAtual(0);

    btnSubmeter.disabled = false
    btnProx.disabled = true
  }

  function preencherHTMLcomQuestaoAtual(index) {
    habilitarAlternativas(true);
    const questaoAtual = listaDeQuestoes[index];
    numeroDaQuestaoAtual = index;

    document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = index + 1;
    document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;

    // Alteração para preencher corretamente as alternativas nos botões
    const botoes = document.querySelectorAll(".opcao");
    botoes[0].innerText = questaoAtual.alternativaA;
    botoes[1].innerText = questaoAtual.alternativaB;
    botoes[2].innerText = questaoAtual.alternativaC || '';
    botoes[3].innerText = questaoAtual.alternativaD || '';
  }


  let respostasQuiz = [];
  function submeter() {
    const options = document.getElementsByName("option");
    let respostaAtual = '';

    let hasChecked = false;
    for (let i = 0; i < options.length; i++) {
      if (options[i].checked) {
        respostaAtual = options[i].value;
        hasChecked = true;
        break;
      }
    }

    if (!hasChecked) {
      alert("Por favor, selecione uma opção.");
    } else {
      respostasQuiz[numeroDaQuestaoAtual] = respostaAtual;
      btnSubmeter.disabled = true;
      btnProx.disabled = false;
      habilitarAlternativas(false);
    }
  }


  function habilitarAlternativas(enable) {
    const botoes = document.querySelectorAll(".opcao");
    botoes.forEach(btn => {
      btn.disabled = !enable;
    });
  }

  function selecionarResposta(alternativa) {
    respostasQuiz[numeroDaQuestaoAtual] = alternativa;

    // Adiciona a classe para destacar a opção selecionada
    const botoes = document.querySelectorAll(".opcao");
    botoes.forEach(btn => {
      btn.classList.remove("selecionado"); // Remove a classe de seleção de todos os botões
    });

    const opcaoSelecionada = document.querySelector(`#${alternativa}`);
    opcaoSelecionada.classList.add("selecionado"); // Adiciona a classe 'selected' à opção escolhida

    // Habilita o botão "Próxima"
    document.querySelector(".btn-proximo").disabled = false;
  }



  function avancar() {
    document.querySelector(".btn-proximo").disabled = true;
    document.querySelector(".btn-submeter").disabled = false;

    limparCoresBackgroundOpcoes();

    if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {
      numeroDaQuestaoAtual++;
      preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)

    } else {
      finalizarJogo();
    }
  }

  function limparCoresBackgroundOpcoes() {
  const botoes = document.querySelectorAll(".opcao");
  botoes.forEach(btn => {
    btn.classList.remove("selecionado");
  });
}


  function finalizarJogo() {
    salvar();

    setTimeout(() => {
      alert("Quiz finalizado! Suas respostas foram salvas.");
      window.location.href = "index.html";
    }, 1000);
  }

  // SCRIPT PARA SALVAR AS RESPOSTAS
  function salvar() {
    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    const salvarDados = {};
    for (let i = 0; i < respostasQuiz.length; i++) {
      if (respostasQuiz[i]) {
        salvarDados[`resposta${i + 1}`] = respostasQuiz[i];
      }
    }


    // Enviando o valor da nova input
    fetch("http://localhost:3333/respostas/salvar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(salvarDados),
    })

      .then(function (resposta) {
        console.log("resposta: ", resposta);
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
    return false;
  }
</script>